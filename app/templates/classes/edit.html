{% extends "/layouts/layout.html" %}

{% block main %}
<div class="container">
    <div class="columns">
        <div class="column">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-header-title title is-3">
                        <span class="has-text-grey mr-2">Class - </span>
                        {{class_model.class_name}}
                    </h1>
                    <button class="card-header-icon">
                        <a href="{{ url_for('classes.home') }}">
                            <span class="icon-text">
                                <span class="icon">
                                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                                </span>
                                <strong>Back To List</strong>
                            </span>
                        </a>
                    </button>
                </div>
                <div class="card-content">
                    {% include "/includes/classes_edit_form.html" %}
                </div>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="column">
            <div class="block">
                <div class="card">
                    <div class="card-header">
                        <h1 class="card-header-title title is-3">Sessions & Attendance</h1>
                    </div>
                    <div class="card-content">
                        <div class="block">
                            <button class="button is-primary modal-trigger" data-target="add-session-modal" data-item-id="{{ class_model.form.class_id.data }}">
                                <span class="icon-text">
                                    <span class="icon">
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                    </span>
                                    <span>Add a Session</span>
                                </span>
                            </button>
                        </div>
                        <div class="block" id="sessions-container">
                            {% if not class_model.sessions %}
                            <div class="notification is-warning is-light">
                                No Sessions Found
                            </div>
                            {% endif %}
                            {% for session in class_model.sessions %}
                            <div class="block">
                                <div class="card">
                                    <header class="card-header is-clickable toggle" data-target="session-attendance-{{ session.id }},session-footer-{{ session.id }}">
                                        <p class="card-header-title">
                                            {% if session.cancelled %}
                                            <s>
                                            {% endif %}

                                            {{ session.name }}: {{ session.date }}

                                            {% if session.cancelled %}
                                            </s>
                                            {% endif %}
                                        </p>
                                        <span class="card-header-icon" aria-label="more options">
                                            <span class="icon">
                                                <i class="fa fa-angle-down" aria-hidden="true"></i>
                                            </span>
                                        </span>
                                    </header>
                                    <div class="card-content is-hidden" id="session-attendance-{{ session.id }}">
                                        {% if not class_model.roster %}
                                        <div class="notification is-warning is-light">
                                            No Students Found
                                        </div>
                                        {% endif %}
                                        {% for attendance_item in session.attendance %}
                                        <div class="columns">
                                            <div class="column is-4">
                                                {{ attendance_item.student_name }}
                                            </div>
                                            <div class="column">
                                                <label class="radio">
                                                    {% if attendance_item.attendance_value == "P" %}
                                                        <input type="radio" name="session{{ session.id }}-student{{ attendance_item.student_id }}-attendance" checked>
                                                        Present
                                                    {% else %}
                                                        <input type="radio" name="session{{ session.id }}-student{{ attendance_item.student_id }}-attendance">
                                                        Present
                                                    {% endif %}
                                                </label>
                                            </div>
                                            <div class="column">
                                                <label class="radio">
                                                    {% if attendance_item.attendance_value == "A" %}
                                                        <input type="radio" name="session{{ session.id }}-student{{ attendance_item.student_id }}-attendance" checked>
                                                        Absent
                                                    {% else %}
                                                        <input type="radio" name="session{{ session.id }}-student{{ attendance_item.student_id }}-attendance">
                                                        Absent
                                                    {% endif %}
                                                </label>
                                            </div>
                                            <div class="column">
                                                <label class="radio">
                                                    {% if attendance_item.attendance_value == "T" %}
                                                        <input type="radio" name="session{{ session.id }}-student{{ attendance_item.student_id }}-attendance" checked>
                                                        Tardy
                                                    {% else %}
                                                        <input type="radio" name="session{{ session.id }}-student{{ attendance_item.student_id }}-attendance">
                                                        Tardy
                                                    {% endif %}
                                                </label>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <footer class="card-footer is-hidden" id="session-footer-{{ session.id }}">
                                        {% if not session.cancelled %}
                                        <a href="#" class="card-footer-item has-background-warning has-text-black">
                                            <span class="icon-text">
                                                <span class="icon">
                                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                                </span>
                                                <span>Cancel</span>
                                            </span>
                                        </a>
                                        <a href="#" class="card-footer-item has-background-danger has-text-white">
                                            <span class="icon-text">
                                                <span class="icon">
                                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                                </span>
                                                <span>Delete</span>
                                            </span>
                                        </a>
                                        {% else %}
                                        <a href="#" class="card-footer-item has-background-primary has-text-black">
                                            <span class="icon-text">
                                                <span class="icon">
                                                    <i class="fa fa-ban" aria-hidden="true"></i>
                                                </span>
                                                <span>Restore</span>
                                            </span>
                                        </a>
                                        {% endif %}
                                    </footer>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="column">
            <div class="block">
                <div class="card">
                    <div class="card-header">
                        <h1 class="card-header-title title is-3">Students</h1>
                    </div>
                    <div class="card-content">
                        <div class="block">
                            <button class="button is-primary modal-trigger" data-target="add-student-modal">
                                <span class="icon-text">
                                    <span class="icon">
                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                    </span>
                                    <span>Add Student</span>
                                </span> 
                            </button>
                        </div>
                        <div class="block">
                            {% if class_model.roster %}
                            <table class="table is-fullwidth">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>
                                            Attendance
                                        </th>
                                        <th>Grade</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for student in class_model.roster %}
                                    <tr>
                                        <td>
                                            <a href="{{ url_for('students.edit', student_id=student.id) }}">
                                                {{ student.full_name() }}
                                            </a>
                                        </td>
                                        <td>
                                            <span class="tag is-success">
                                                P: ?
                                            </span>
                                            <span class="tag is-danger">
                                                A: ?
                                            </span>
                                            <span class="tag is-warning">
                                                T: ?
                                            </span>
                                        </td>
                                        <td>?</td>
                                        <td>
                                            <button class="button is-danger">
                                                <span class="icon-text">
                                                    <span class="icon">
                                                        <i class="fa fa-ban" aria-hidden="true"></i>
                                                    </span>
                                                    <span>Remove</span>
                                                </span>
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                            {% else %}
                            <div class="notification is-warning is-light">No Students Found</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="column">
            <div class="block">
                <div class="card">
                    <div class="card-header">
                        <h1 class="card-header-title title is-3">Assignments & Grades</h1>
                    </div>
                    <div class="card-content">
                        To Be Determined
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- MODALS -->
    <div class="modal" id="add-session-modal">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Add a Session to {{ class_model.class_name }}</p>
          </header>
          <section class="modal-card-body">
            <form id="class-add-session-form">
                <input type="hidden" name="itemId" value="{{ class_model.form.class_id.data }}">
                <div class="field">
                    <label class="label">Name</label>
                    <div class="control">
                      <input class="input" name="session_name" type="text">
                    </div>
                    <p class="help">If left blank the system will automatically generate a name.</p>
                </div>
                <div class="field">
                    <label class="label">Date & Time</label>
                    <div class="control">
                      <input class="input" name="session_time" type="datetime-local" placeholder="">
                    </div>
                </div>
            </form>
            <!-- Content ... -->
          </section>
          <footer class="modal-card-foot">
            <div class="buttons">
              <button class="button is-success" id="class-add-session-btn">Save</button>
              <button class="button close-modal">Cancel</button>
            </div>
          </footer>
        </div>
    </div>
    <div class="modal" id="add-student-modal">
        <div class="modal-background"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Add Student</p>
          </header>
          <section class="modal-card-body">
            <form>
                {% for student in class_model.non_roster %}
                <label class="checkbox">
                    <input type="checkbox" />
                    {{ student.full_name() }}
                  </label>
                {% endfor %}
                <div class="select">
                    <select>
                        {% for student in class_model.non_roster %}
                        <option>{{student.full_name()}}</option>
                        {% endfor %}
                    </select>
                  </div>
            </form>
            <!-- Content ... -->
          </section>
          <footer class="modal-card-foot">
            <div class="buttons">
              <button class="button is-success">Save</button>
              <button class="button close-modal">Cancel</button>
            </div>
          </footer>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
    <script src="{{ url_for('static', filename='js/classes/edit.js')}}" type="text/javascript"></script>
{% endblock %}